{% from "social-list.njk" import socialList %}
{% set navPages = collections.all | eleventyNavigation %}

{% if page.url == '/services/workshops/' or page.url == '/services/digital-products-and-design/' or page.url ==
'/services/team-augmentation-and-training/' or page.url == '/work/' or page.url == '/playbook/' or page.url ==
'/events/' %}
  {% set ctaColor = 'purple' %}
{% else %}
  {% set ctaColor = 'aqua' %}
{% endif %}

{# Prevent flash of submenu on page load #}
<style>
  .nav-submenu__menu {
    opacity: 0;
  }
</style>

<nav class="nav nav--accent-{{ ctaColor }}" id="nav">
  <div class="nav__wrapper container container--xl">
    <div class="nav__logo">
      {% set tag = 'a' %}
      {% if page.url == '/' %}
        {% set tag = 'h1' %}
      {% endif %}
      <{{ tag }} class="nav__brand" {% if tag == 'a' %} href="/" {% endif %}>
        {% include 'svg/logo.njk' %}
        <span class="screenreader">Mainmatter</span>
      </{{ tag }}>
    </div>
    <ul class="nav__list">
      <li class="nav__item nav-submenu" data-has-modal>
        <button class="nav-submenu__toggle nav__link" aria-expanded="false" data-menu-toggle>
          <span class="nav__link-text{% if page.url and '/services/' in page.url %} nav__link-text--active{% endif %}">Services</span>
          {% include 'svg/arrow.njk' %}
        </button>
        <div class="nav-submenu__menu" aria-modal="true" data-modal aria-label="Services submenu">
          <div class="nav-submenu__menu-inner">
            <button class="nav-submenu__menu-close" data-menu-close>
              {% include 'svg/close.njk' %}
              <span class="screenreader">Close Services submenu</span>
            </button>
            <div class="submenu__list-wrapper">
              <ul class="nav-submenu__list">
                <li class="nav-submenu__item">
                  <a class="nav-submenu__link" href="/services/workshops/" {% if '/services/workshops/'== page.url %} aria-current="page" {% endif %}>
                    {% include 'svg/arrow.njk' %}
                    <span class="nav-submenu__link-text">Workshops</span>
                  </a>
                </li>
                <li class="nav-submenu__item">
                  <a class="nav-submenu__link" href="/services/digital-products-and-design/" {% if '/services/digital-products-and-design/'== page.url %} aria-current="page" {% endif %}>
                    {% include 'svg/arrow.njk' %}
                    <span class="nav-submenu__link-text">Digital Products & Design</span>
                  </a>
                </li>
                <li class="nav-submenu__item">
                  <a class="nav-submenu__link" href="/services/team-augmentation-and-training/" {% if '/services/team-augmentation-and-training/'== page.url %} aria-current="page" {% endif %}>
                    {% include 'svg/arrow.njk' %}
                    <span class="nav-submenu__link-text">Team Augmentation & Training</span>
                  </a>
                </li>
              </ul>
            </div>
            {% include 'global/nav-aside.njk' %}
          </div>
        </div>
      </li>

      {%- for entry in navPages %}
        <li class="nav__item nav-submenu" {% if entry.children.length > 0 %} data-has-modal {% endif %}>
          {% if entry.url == '/work/' %}{% set parentChildCompare = '/cases/' %}{% else %}{% set parentChildCompare = entry.url %}{% endif %}
          <a class="nav__link nav__link-text{% if entry.url == page.url or (page.url and parentChildCompare in page.url) %} nav__link-text--active{% endif %}" {% if entry.url == page.url %} aria-current="page" {% endif %} href="{{ entry.url | url }}">
            {{ entry.title }}
          </a>
        </li>
      {%- endfor %}

    </ul>
    <div class="nav__aside">
      <a class="nav__cta nav__cta--{{ ctaColor }} text--sm" href="/contact/">
        Contact us
      </a>
      <div class="nav__mobile-menu-wrapper" data-has-modal>
        <button class="nav__menu-toggle" data-menu-toggle aria-expanded="false">
          {% include 'svg/menu.njk' %}
          <span class="screenreader">Toggle Menu</span>
        </button>
        {% include 'global/mobile-menu.njk' %}
      </div>
    </div>
  </div>
</nav>