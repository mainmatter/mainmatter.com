---
title: "Ember Initiative: Measure the impact of Vite on your project"
authorHandle: pichfl
tags: [ember, embroider, vite]
bio: "Florian Pichler, Software Developer"
description: ""
autoOg: true
customCta: "global/whirlwind-cta.njk"
tagline: <p>Help</p>
image: ""
imageAlt: ""
---

One goal of the Ember Initiative is moving from the current build chain using `ember-cli` and `embroider` with `webpack` to a more unified approach using `vite`.

One of our sponsors of the Ember Initiative approached us to measure the differences in build and page reaction to make sure that their large application won't perform worse for developers and users alike. We've built that tool for them, but we also made sure it's open source and easy to use so we can get more metrics from you across the Ember.js community.

## A high level recap of changes

The current setup with `ember-cli` uses `broccoli`, and `webpack` through `embroider`. Everything is compiled up front and the app is loaded as a few bundled AMD-based files; even when the app runs in development mode. Roughly said, we are slow first, but save some speed later by bundling everything up.

Vite changes things a lot. It has multiple stages to optimize the input and sends real JavaScript modules and entry points to the client. We start blazing fast and only get slowed down as the browser isn't so great at loading large numbers of tiny files.

## Build, Measure, Optimize, Repeat

We think, the change is worth it. Vite is the future for Ember and while it feels different, it should speed us up.

## We need _your_ numbers

To verify these claims, we'll need your help, and data from your apps big and small.

We are interested in the following metrics, both from a cold start and a warm start after caches have been created:

- Production build time after installing the packages
- Development server startup time
- Development time to first paint
- Development time to app load, waiting for an element rendered by your app
- Development reload time after a file in your app changes

We built [build-start-rebuild-perf](https://github.com/mainmatter/build-start-rebuild-perf) to take care of the development measurements. See it's README for or `--help` output for supported parameters.

### Test protocol

As projects have their individual choices, we decided to not fully automate the workflow. This post makes assumes a plain Ember project as generated by a current run of `ember-cli init`. 

Expectations:

- You run macOS or Linux (or are willing to go on your own adventures on Windows)
- You have a `main` branch of your app that builds and runs using `ember-cli`
- You have a `migrate-to-vite` branch that builds and runs using the _new_ Embroider and Vite
- Either branches use the same version of node and the package manager of your choice i.e. pnpm
- Your app has a `<img class="logo">` that is part of your components and _not_ inside your `index.html`
- Your app has a `app/router.js` which when changed triggers `ember-cli` or `vite` to rebuild

Let's get started! Open up the [survey form](https://www.notion.so/mainmatter/Testing-forms-24c64e58ddfa8033913bd3545df03386), which will give you the same prompts as below and input fields to put the results. Don't rush this.

```sh
# Start from main
git switch main

# Make sure you clear out artifacts
rm -r dist

# 1 - Ember CLI Production Build Time
# -----------------------------------
# Run your ember-cli build with `time` to measure things.
# Assumes your `build` command runs `ember build --env=production`
# The output will print extra output at the end,
# containing the execution optimize measurement
# We are looking for the "real" or "total" or "Executed in" number,
# i.e. "real 0m4.139s"
time npm run build

# 2 - Cold Start
# --------------
# 2.1 Dev Server Ready
# 2.2 Development time to first paint
# 2.3 First Paint
# 2.4 Development reload time
# All of the above are returned by running build-start-rebuild-perf
# Assuming that your developement server launches at //localhost:4200
npx build-start-rebuild-perf --file "app/router.js" --wait-for ".logo" --command "npm start"

# 3 - Warm Start - Repeat the command from 2 without clearing caches
npx build-start-rebuild -perf --file "app/router.js" --wait-for ".logo" --command "npm start"

# Delete build output and switch to your Vite branch
rm -r dist
git switch migrate-to-vite

# 4 - Vite Production Build
# Run your vite build with `time` to measure things.
# # Assumes your `build` command runs `vite build --prod`
time npm run build

# 5 - Vite Cold Start
# --------------
# Get the numbers for 5.1 to 5.4 by repeating the command from #2
npx build-start-rebuild-perf --file "app/router.js" --wait-for ".logo" --command "npm start"

# 6 - Vite Warm Start
# --------------
# Get the numbers for 6.1 to 6.4 by repeating the command from #3
npx build-start-rebuild-perf --file "app/router.js" --wait-for ".logo" --command "npm start"

# Enter all numbers in the survey form at:
# https://www.notion.so/mainmatter/Testing-forms-24c64e58ddfa8033913bd3545df03386
```

You made it. Thank you for contributing to the Ember Initiative's efforts.
